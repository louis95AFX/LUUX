<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUU'S EXCELLENCE - The Full Collection</title>
    <link rel="icon" href="item27.jpeg" type="image/jpeg">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        :root { --gold: #d4af37; --dark-bg: #111; --card-bg: #1a1a1a; }
        
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--dark-bg); color: #fff; overflow-x: hidden; }
        
        /* Header & Nav */
        .main-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; background: #000; position: sticky; top: 0; z-index: 1000; }
        .logo { font-family: 'Playfair Display', serif; font-weight: bold; font-size: 1.5rem; letter-spacing: 2px; color: var(--gold); }
        .nav-links a { color: white; margin-left: 20px; text-decoration: none; font-size: 0.9rem; transition: color 0.3s; }
        .nav-links a:hover { color: var(--gold); }

        /* Product Grid */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; padding: 40px 5%; }
        .product-card { background: var(--card-bg); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; transition: transform 0.3s, box-shadow 0.3s; border: 1px solid #222; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .product-img { width: 100%; height: 320px; object-fit: cover; }
        .product-info { padding: 20px; flex-grow: 1; text-align: center; }
        .product-info h3 { font-family: 'Playfair Display', serif; margin: 0 0 10px; font-size: 1.2rem; }
        .product-price { color: var(--gold); font-weight: bold; font-size: 1.1rem; margin-bottom: 15px; }
        
        .add-to-cart-btn { 
            width: 100%; background: transparent; border: 1px solid var(--gold); color: var(--gold); 
            padding: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; 
        }
        .add-to-cart-btn:hover { background: var(--gold); color: #000; }

        /* Cart Drawer */
        #cartDrawer { position: fixed; top: 0; right: -450px; width: 100%; max-width: 400px; height: 100%; background: #000; z-index: 2000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 30px; box-sizing: border-box; display: flex; flex-direction: column; }
        #cartDrawer.open { right: 0; }
        #cartOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); display:none; z-index:1999; backdrop-filter: blur(4px); }
        
        .cart-header { display: flex; justify-content: space-between; align-items:center; border-bottom:1px solid #333; padding-bottom:15px; margin-bottom:20px; }
        .cart-items { flex-grow:1; overflow-y:auto; }
        .cart-footer { border-top:1px solid #333; padding-top:20px; margin-top:10px; }
        .cart-total { display:flex; justify-content:space-between; margin-bottom:20px; font-size: 1.2rem; font-weight:bold; color: var(--gold); }
        .checkout-btn { width:100%; padding: 15px; background: var(--gold); border:none; color:#000; font-weight:bold; cursor:pointer; text-transform: uppercase; letter-spacing: 1px; }

        .product-image-wrapper { position: relative; cursor: pointer; }
.product-overlay { 
    position: absolute; top:0; left:0; width:100%; height:100%; 
    background: rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; 
    opacity:0; transition:0.3s; 
}
.product-image-wrapper:hover .product-overlay { opacity:1; }
.quick-view-btn { color: var(--gold); font-weight:bold; padding:8px 15px; border:1px solid var(--gold); }

.color-selector { display:flex; gap:5px; margin-bottom:10px; justify-content:center; flex-wrap:wrap; }
.color-chip { display:flex; align-items:center; cursor:pointer; font-size:12px; }
.color-chip input { display:none; }
.color-chip span { padding:4px 8px; border:1px solid #ccc; border-radius:4px; transition:0.3s; }
.color-chip input:checked + span { border-color: var(--gold); background: var(--gold); color:#000; }

.controls-spacer { flex-grow:1; }

.product-controls { display:flex; flex-direction:column; gap:10px; }
.qty-input { display:flex; align-items:center; justify-content:center; gap:5px; }
.qty-input button { background:none; border:1px solid #fff; color:#fff; font-size:16px; padding:0 8px; cursor:pointer; }
.qty-input input { width:40px; text-align:center; background:#111; border:none; color:#fff; }


        @media (max-width: 600px) { .nav-links { display: none; } }
    </style>
</head>
<body>

<header class="main-header">
    <div class="logo">LUU'S EXCELLENCE</div>
    <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="collection.html">Collection</a>
        <a href="index.html#vision">About</a>
    </nav>
    <button onclick="toggleCart()" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;position:relative;">
        <i class="fas fa-shopping-bag"></i>
        <span id="cart-count" style="position:absolute; top:-10px; right:-10px; background:var(--gold); color:#000; font-size:12px; padding:2px 6px; border-radius:50%; font-weight:bold;">0</span>
    </button>
</header>

<div id="cartOverlay" onclick="toggleCart()"></div>
<div id="cartDrawer">
    <div class="cart-header">
        <h3 style="font-family:'Playfair Display'; margin:0;">Your Bag</h3>
        <button onclick="toggleCart()" style="background:none;border:none;color:white;font-size:28px;cursor:pointer;">&times;</button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-footer">
        <div class="cart-total">
            <span>Subtotal</span>
            <span id="cartTotal">R 0.00</span>
        </div>
        <button class="checkout-btn" onclick="checkout()">Proceed to Checkout</button>
    </div>
</div>

<main>
    <h1 style="text-align:center; margin-top:50px; font-family:'Playfair Display'; font-size: 2.5rem;">The Full Collection</h1>
    <div class="product-grid" id="product-grid">
        </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = 'https://qvixtdbmxzdsrkmgehrv.supabase.co'; 
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aXh0ZGJteHpkc3JrbWdlaHJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwNjgwMTEsImV4cCI6MjA3OTY0NDAxMX0.sIljGo1502j_XubqqQ4K98MuzA5ZkXy9lVgV1qB_mzI';

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
let cart = JSON.parse(localStorage.getItem('luus_cart')) || [];

async function fetchAndDisplayProducts() {
    const grid = document.getElementById('product-grid');
    grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">Curating excellence...</p>';

    const { data, error } = await supabaseClient
        .from('products')
        .select('*')
        .order('created_at', { ascending: false });

    if (error) {
        grid.innerHTML = '<p style="color:red; grid-column: 1/-1; text-align:center;">Error loading collection.</p>';
        return;
    }

    grid.innerHTML = data.map(product => {
        const escapedName = product.name.replace(/'/g, "\\'");
        const escapedDesc = (product.description || "").replace(/'/g, "\\'");
        const formattedPrice = `R ${parseFloat(product.price).toLocaleString(undefined, { minimumFractionDigits: 2 })}`;
        const productId = `p-${product.id || product.name.replace(/\s+/g, '-').toLowerCase()}`;

        const colors = product.colors && product.colors.length > 0 ? product.colors : [];
        const colorOptions = colors.map((color, idx) => `
            <label class="color-chip">
                <input type="radio" name="color-${productId}" value="${color}" ${idx === 0 ? 'checked' : ''}>
                <span>${color}</span>
            </label>
        `).join('');

        return `
            <div class="product-card">
                <div 
                    class="product-image-wrapper"
                    onclick="openModal('${escapedName}', '${formattedPrice}', '${product.image_url}', '${escapedDesc}')"
                >
                    <img src="${product.image_url || 'https://via.placeholder.com/300x400?text=Luxury+Piece'}" class="product-img" alt="${product.name}">
                    <div class="product-overlay">
                        <span class="quick-view-btn">QUICK VIEW</span>
                    </div>
                </div>

                <div class="product-info">
                    <h3 class="product-name">${product.name}</h3>
                    <p class="product-price">${formattedPrice}</p>

                    ${colors.length > 0 ? `<div class="color-selector">${colorOptions}</div>` : ''}

                    <div class="controls-spacer"></div>

                    <div class="product-controls">
                        <div class="qty-input" onclick="event.stopPropagation()">
                            <button aria-label="Decrease" onclick="updateQty('${productId}', -1)">âˆ’</button>
                            <input type="number" id="qty-${productId}" value="1" min="1" readonly>
                            <button aria-label="Increase" onclick="updateQty('${productId}', 1)">+</button>
                        </div>

                        <button 
                            class="add-to-cart-btn"
                            onclick="
                                event.stopPropagation();
                                const qty = document.getElementById('qty-${productId}').value;
                                const selectedColor = document.querySelector('input[name=\\'color-${productId}\\']:checked')?.value || 'Standard';
                                addToCart('${escapedName}', '${product.price}', '${product.image_url}', qty, selectedColor);
                                document.getElementById('qty-${productId}').value = 1;
                            "
                        >
                            ADD TO BAG
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}


function toggleCart() {
    const drawer = document.getElementById('cartDrawer');
    const overlay = document.getElementById('cartOverlay');
    drawer.classList.toggle('open');
    overlay.style.display = drawer.classList.contains('open') ? 'block' : 'none';
}

function addToCart(name, price, image) {
    const existing = cart.find(i => i.name === name);
    if (existing) {
        existing.quantity += 1;
    } else {
        cart.push({ name, price: parseFloat(price), image, quantity: 1 });
    }
    saveCart();
    toggleCart();
}

function removeFromCart(index) {
    cart.splice(index, 1);
    saveCart();
}

function saveCart() {
    localStorage.setItem('luus_cart', JSON.stringify(cart));
    updateCartUI();
}

function updateCartUI() {
    const container = document.getElementById('cartItems');
    const count = document.getElementById('cart-count');
    const totalElem = document.getElementById('cartTotal');

    const totalQty = cart.reduce((sum, item) => sum + item.quantity, 0);
    count.innerText = totalQty;

    if (cart.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; margin-top:50px;">Your bag is empty.</p>';
        totalElem.innerText = 'R 0.00';
        return;
    }

    let subtotal = 0;
    container.innerHTML = cart.map((item, idx) => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        return `
            <div style="display:flex; gap:15px; margin-bottom:20px; align-items:center;">
                <img src="${item.image}" style="width:70px; height:90px; object-fit:cover; border-radius:4px;">
                <div style="flex-grow:1;">
                    <p style="margin:0; font-weight:bold; font-size:14px;">${item.name}</p>
                    <p style="margin:5px 0; color:var(--gold); font-size:13px;">${item.quantity} x R ${item.price.toLocaleString()}</p>
                </div>
                <button onclick="removeFromCart(${idx})" style="background:none; border:none; color:#ff4444; cursor:pointer;"><i class="fas fa-trash-alt"></i></button>
            </div>
        `;
    }).join('');
    
    totalElem.innerText = `R ${subtotal.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
}

function checkout() {
    if (cart.length === 0) return alert("Your bag is empty!");
    alert("This would typically redirect to a payment gateway like PayFast or Yoco.");
}

document.addEventListener('DOMContentLoaded', () => {
    fetchAndDisplayProducts();
    updateCartUI();
});
function addToCart(name, price, image, quantity = 1, color = 'Standard') {
    const imgUrl = image || 'https://via.placeholder.com/300x400?text=Luxury+Piece';
    const existing = cart.find(i => i.name === name && i.color === color);
    if (existing) {
        existing.quantity += parseInt(quantity);
    } else {
        cart.push({ name, price: parseFloat(price), image: imgUrl, quantity: parseInt(quantity), color });
    }
    saveCart();
    updateCartUI();
}

</script>

</body>
</html>